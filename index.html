<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é®‘å…¬æ†é½‹ç”Ÿå£™å¿— - Interactive Reader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Songti SC", "Noto Serif CJK SC", "Source Han Serif SC", serif;
            background: #f5f0e6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 10px;
            padding: 8px 0;
        }

        header h1 {
            font-size: 1.3em;
            color: #8b4513;
            white-space: nowrap;
        }

        header p {
            font-size: 0.85em;
            color: #666;
        }

        /* Vertical slider container */
        .vertical-slider {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            gap: 4px;
        }

        .vertical-slider .slider-label {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 0.75em;
            color: #666;
            letter-spacing: 1px;
        }

        .vertical-slider input[type="range"] {
            writing-mode: vertical-lr;
            direction: rtl;
            height: 120px;
            width: 20px;
            cursor: pointer;
        }

        .main-content {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .document-area {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .document-container {
            position: relative;
            background: #fffef9;
            border: 2px solid #8b4513;
            border-radius: 8px;
            overflow: hidden;
            width: 600px;
            height: 600px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .original-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
            z-index: 1;
        }

        .document {
            position: absolute;
            top: 2%;
            right: 1%;
            width: 360px;  /* 60% of base 600px */
            height: 360px; /* 60% of base 600px */
            z-index: 2;
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-start;
            align-items: flex-start;
            padding: 0;
            background: transparent;
            transform-origin: top right;
            /* Scale factor applied by JS to match container size */
        }

        .column {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            margin: 0 4.2px;
            flex-shrink: 0;
            position: relative;
        }

        .column.title-column {
            border-left: 1px solid #8b4513;
            padding-left: 5px;
            margin-left: 3px;
        }

        .column.title-column .char {
            font-size: 16px;
            font-weight: bold;
            line-height: 1.15;
        }

        .char {
            font-size: 12px;
            line-height: 1.35;
            cursor: pointer;
            padding: 0.5px 1px;
            border-radius: 2px;
            transition: all 0.15s ease;
            display: block;
            color: rgba(45, 30, 20, var(--text-opacity, 1));
            background: rgba(255, 254, 249, var(--text-bg-opacity, 0.9));
            position: relative;
        }

        .char:hover {
            transform: scale(1.1);
        }

        .char.char-highlight {
            outline: 2px solid #e74c3c;
            outline-offset: 0px;
        }

        .char.locked {
            background: rgba(180, 140, 0, 0.15) !important;
        }

        /* Highlight boxes float on top of characters */
        /* Section (outermost) â†’ Phrase â†’ Character (innermost) */

        .section-highlight-box {
            position: absolute;
            border: 2px solid rgba(39, 174, 96, 0.7);
            border-radius: 6px;
            pointer-events: none;
            z-index: 100;
        }

        .phrase-highlight-box {
            position: absolute;
            border: 2px solid #3498db;
            border-radius: 4px;
            pointer-events: none;
            z-index: 101;
        }

        .info-panel {
            width: 380px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            flex-shrink: 0;
        }

        /* Character Level - RED - at top */
        .char-info-box {
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 10px;
            background: #fdf2f2;
            position: relative;
        }

        .lock-icon {
            position: absolute;
            bottom: 6px;
            right: 6px;
            font-size: 14px;
            cursor: pointer;
            opacity: 0.7;
            display: none;
        }

        .lock-icon:hover {
            opacity: 1;
        }

        .character-display {
            font-size: 48px;
            text-align: center;
            padding: 4px;
            background: #fff;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        .pinyin {
            font-size: 1em;
            color: #8b4513;
            text-align: center;
            margin-bottom: 4px;
        }

        .char-meaning {
            font-size: 0.85em;
            line-height: 1.3;
            color: #333;
            text-align: center;
        }

        .char-context {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
            font-style: italic;
            line-height: 1.3;
            text-align: center;
        }

        /* Phrase Level - BLUE - middle */
        .phrase-info-box {
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 10px;
            background: #f0f7fd;
            min-height: 189px;
        }

        .phrase-chinese {
            font-size: 1.2em;
            text-align: center;
            padding: 4px;
            background: #fff;
            border-radius: 4px;
            margin-bottom: 6px;
            letter-spacing: 2px;
        }

        .phrase-translation {
            font-size: 0.9em;
            line-height: 1.35;
            color: #333;
            margin-bottom: 6px;
        }

        .phrase-notes {
            font-size: 0.8em;
            color: #555;
            line-height: 1.3;
        }

        /* Section Level - GREEN - bottom */
        .section-info-box {
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 10px;
            background: #f0fdf4;
            min-height: 140px;
        }

        .section-title {
            font-size: 1em;
            font-weight: bold;
            color: #1e8449;
            margin-bottom: 2px;
        }

        .section-chinese {
            font-size: 0.9em;
            color: #27ae60;
            margin-bottom: 4px;
        }

        .section-description {
            font-size: 0.8em;
            line-height: 1.3;
            color: #333;
        }

        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }

            .info-panel {
                width: 100%;
                position: static;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>é®‘å…¬æ†é½‹ç”Ÿå£™å¿—</h1>
            <p>Burial Record of Mr. Bao Zhetai â€” From the Bao Family Genealogy of Gouyu, Volume 6</p>
        </header>

        <div class="main-content">
            <div class="document-area">
                <div class="document-container" id="documentContainer">
                    <img src="original.png" alt="Original document" class="original-image" id="originalImage">
                    <div class="document" id="document">
                        <!-- Content generated by JavaScript -->
                    </div>
                </div>
                <div class="vertical-slider">
                    <span class="slider-label">Transcribed</span>
                    <input type="range" id="overlaySlider" min="0" max="100" value="0">
                    <span class="slider-label">Original</span>
                </div>
            </div>

            <div class="info-panel" id="info-panel">
                <!-- Character at top (RED) -->
                <div class="char-info-box" id="charBox">
                    <div class="character-display" id="charDisplay">é®‘</div>
                    <div class="pinyin" id="pinyin">bÃ o</div>
                    <div class="char-meaning" id="charMeaning">Surname Bao; also means salted fish</div>
                    <div class="char-context" id="charContext">The family surname. An important clan in the Ningbo region.</div>
                    <span class="lock-icon" id="lockIcon" title="Click to unlock">ğŸ”’</span>
                </div>

                <!-- Phrase in middle (BLUE) -->
                <div class="phrase-info-box" id="phraseBox">
                    <div class="phrase-chinese" id="phraseChinese">é®‘å…¬æ†é½‹ç”Ÿå£™å¿—</div>
                    <div class="phrase-translation" id="phraseTranslation">"Burial Record of Mr. Bao Hengzhai"</div>
                    <div class="phrase-notes" id="phraseNotes">å…¬ is an honorific. æ†é½‹ (Hengzhai, "Persevering Studio") is his courtesy name (å­—). ç”Ÿå£™å¿— indicates this epitaph was prepared during his lifetime.</div>
                </div>

                <!-- Section at bottom (GREEN) -->
                <div class="section-info-box" id="sectionBox">
                    <div class="section-title" id="sectionTitle">Document Title</div>
                    <div class="section-chinese" id="sectionChinese">æ¨™é¡Œ</div>
                    <div class="section-description" id="sectionDesc">The formal title of this burial record (å£™å¿—). A å£™å¿— is an epitaph or biographical inscription traditionally placed in or near the tomb.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== DOCUMENT DATA STRUCTURE ==========
        // Organized hierarchically: Sections > Phrases > Characters
        // ALIGNMENT VALUES from original commit ecf7514

        const sections = {
            spine: {
                name: 'Book Spine',
                chinese: 'æ›¸è„Š',
                description: 'The outer cover of the genealogy volume, displaying the clan name, volume number, document type, and publishing hall name. These elements identify the source and context of the burial record within the larger genealogical compilation.'
            },
            title: {
                name: 'Document Title',
                chinese: 'æ¨™é¡Œ',
                description: 'The formal title of this burial record (å£™å¿—). A å£™å¿— is an epitaph or biographical inscription traditionally placed in or near the tomb, recording the deceased\'s life for posterity.'
            },
            ancestry: {
                name: 'Name & Origins',
                chinese: 'å§“åç±è²«',
                description: 'This section establishes the subject\'s identity: his personal name (å), courtesy name (å­—), surname (å§“), and ancestral home. In Chinese tradition, recording one\'s geographic origins connects the individual to their lineage and community.'
            },
            family_background: {
                name: 'Ancestors & Parents',
                chinese: 'å…ˆä¸–çˆ¶æ¯',
                description: 'A listing of the subject\'s immediate ancestors: great-grandfather, grandfather, and father, along with his mother\'s maiden name and information about siblings. This establishes his place in the family lineage.'
            },
            youth: {
                name: 'Youth & Early Character',
                chinese: 'å¹¼å¹´å“æ€§',
                description: 'This section describes the subject\'s character from childhood: his diligence, honesty, and adherence to proper conduct. It also notes the early loss of both parents, which shaped his self-reliance.'
            },
            virtues: {
                name: 'Virtues & Philanthropy',
                chinese: 'å¾·è¡Œå–„èˆ‰',
                description: 'This section praises the subject\'s moral character in his business dealings, his Christian faith, and his generous philanthropic contributions to community institutions in both Shanghai and his hometown, including hospitals, schools, and clan temples.'
            },
            occupation: {
                name: 'Occupation & Career',
                chinese: 'è·æ¥­ç¶“æ­·',
                description: 'A chronicle of the subject\'s working life: from early work in local shops, to fishing along the Jiangsu-Zhejiang coast, to his move to Shanghai at age 30 where he found success in the clothing trade and coal business.'
            },
            family: {
                name: 'Marriage & Children',
                chinese: 'å©šå§»å­å¥³',
                description: 'Records of the subject\'s wives and descendants. He had two wives (the first predeceased him) and multiple children and grandchildren, whose names are listed to document the continuation of the family line.'
            },
            death: {
                name: 'Birth & Death',
                chinese: 'ç”Ÿå’',
                description: 'The subject\'s birth and death dates, given in both the traditional Chinese calendar (using reign periods and the sexagenary cycle) and by age. This section also notes when he commissioned his burial site.'
            },
            burial: {
                name: 'Burial Site & Geomancy',
                chinese: 'è‘¬åœ°é¢¨æ°´',
                description: 'Description of the tomb\'s location at Phoenix Mountain (å¤©é³³å±±) and its favorable feng shui qualities. The poetic language describes the landscape as resembling a phoenix in flight, an extremely auspicious configuration that will bless his descendants.'
            },
            credit: {
                name: 'Attribution',
                chinese: 'ç½²å',
                description: 'Credits for the document\'s composition. Zhang Meiyi (å¼µç¾ç¿Š, 1856-1924) was a prominent Ningbo scholar who wrote the text. "æ›¸ä¸¹" credits the calligrapher who wrote the characters in red ink for carving.'
            }
        };

        // Phrases organized by section, with translations and scholarly notes
        const phrases = [
            // SPINE
            { section: 'spine', chars: 'å¥ä¿é®‘æ°å®—è­œ', translation: 'Bao Clan Genealogy of Gouyu', notes: 'å¥ä¿ (GÅuyÃº) is an archaic toponym for the Siming Mountains region near Ningbo. å®—è­œ (zÅngpÇ”) is a formal clan genealogyâ€”a vital document recording lineage, marriages, and achievements across generations. Such genealogies were compiled and updated periodically, often funded by successful clan members.' },
            { section: 'spine', chars: 'å·å…­', translation: 'Volume Six', notes: 'å· (juÃ n) originally meant a scroll; here it indicates a bound volume. Large clan genealogies often comprised dozens of volumes organized by branch, generation, or document type.' },
            { section: 'spine', chars: 'ç”Ÿå£™å¿—', translation: 'Burial Record [Prepared During Lifetime]', notes: 'ç”Ÿå£™ (shÄ“ngkuÃ ng) specifically indicates a tomb prepared while the subject was still aliveâ€”a practice of the wealthy that ensured proper burial arrangements. å¿— (zhÃ¬) means "record" or "treatise," giving the document scholarly gravitas.' },
            { section: 'spine', chars: 'æ­£å§‹å ‚', translation: 'Zhengshi Hall', notes: 'å ‚è™Ÿ (tÃ¡nghÃ o, "hall name") identifies the family branch or publishing house. æ­£å§‹ means "correct beginning" or "orthodox origin"â€”an auspicious name suggesting adherence to proper Confucian tradition. Hall names distinguished different branches of large clans.' },

            // TITLE
            { section: 'title', chars: 'é®‘å…¬æ†é½‹ç”Ÿå£™å¿—', translation: 'Burial Record of Mr. Bao Hengzhai', notes: 'å…¬ (gÅng) is an honorific meaning "gentleman" or "sir." æ†é½‹ (HÃ©ngzhÄi, "Studio of Perseverance") is his courtesy name (å­—). The title ç”Ÿå£™å¿— indicates this epitaph was composed while he was still livingâ€”a mark of foresight and proper preparation for death.' },

            // ANCESTRY
            { section: 'ancestry', chars: 'å…¬åå“²æ³°', translation: 'The gentleman\'s given name was Zhetai', notes: 'å (mÃ­ng) is the personal name given at birth, used by elders and in formal documents. å“² means "wise" or "sagacious"; æ³° means "great" or "peaceful"â€”auspicious characters reflecting parental hopes.' },
            { section: 'ancestry', chars: 'å­—æ†é½‹', translation: 'Courtesy name Hengzhai', notes: 'å­— (zÃ¬) is the courtesy name, traditionally given at age 20 during the capping ceremony. It was used by peers and in polite address. æ† (constant, persevering) + é½‹ (study, studio) suggests a scholarly, steadfast character.' },
            { section: 'ancestry', chars: 'å§“é®‘æ°', translation: 'Of the Bao surname', notes: 'å§“ (xÃ¬ng) introduces the family surname. æ° (shÃ¬) is a formal suffix used in genealogical contexts. The Bao clan traces its origins to the ancient state of Bao in Shaanxi.' },
            { section: 'ancestry', chars: 'ä¸–ç¯¤', translation: 'For generations devoted [to this place]', notes: 'ä¸– (shÃ¬) means "generations." ç¯¤ (dÇ”) means "sincere" or "devoted." Together, ä¸–ç¯¤ emphasizes the family\'s deep, longstanding roots in their homelandâ€”a point of pride in Chinese genealogical tradition.' },
            { section: 'ancestry', chars: 'é„å—é„å¡˜é„‰é®‘å®¶åŸ­äºº', translation: 'A person of Baojiadai village, Nantang Township, southern Yin County', notes: 'é„ (YÃ­n) County is now part of Ningbo, Zhejiang. é„‰ (xiÄng) means township. åŸ­ (dÃ i) means "embankment" or "dike"â€”common in Jiangnan place names reflecting the region\'s water-management heritage. äºº (rÃ©n) means "person of [this place]."' },

            // FAMILY BACKGROUND
            { section: 'family_background', chars: 'æ›¾ç¥–å»·æš', translation: 'Great-grandfather [named] Tingyang', notes: 'æ›¾ç¥– (zÄ“ngzÇ”) means great-grandfather. Recording three generations of ancestors was standard in formal biographies, establishing the subject\'s lineage and social standing.' },
            { section: 'family_background', chars: 'ç¥–å…‰è¯', translation: 'Grandfather [named] Guanghua', notes: 'ç¥– (zÇ”) means grandfather. å…‰è¯ means "glory and splendor"â€”an auspicious name expressing hopes for the family\'s flourishing.' },
            { section: 'family_background', chars: 'çˆ¶æ˜æ˜Œ', translation: 'Father [named] Mingchang', notes: 'çˆ¶ (fÃ¹) means father. æ˜æ˜Œ combines "bright" and "prosperous"â€”reflecting aspirations for success and virtue.' },
            { section: 'family_background', chars: 'æ¯ä¾¯æ°', translation: 'Mother, nÃ©e Hou', notes: 'Women in traditional genealogies are identified by their maiden surname plus æ° (shÃ¬, "clan"). Personal names of women were often not recorded in formal documents, reflecting their identity through their birth family.' },
            { section: 'family_background', chars: 'å…„å¼ŸäºŒäºº', translation: 'Two brothers [in the family]', notes: 'å…„å¼Ÿ (xiÅngdÃ¬) means brothers. The phrase indicates the total number of male siblings, including the subject himself.' },
            { section: 'family_background', chars: 'å…¬å…¶é•·ä¹Ÿ', translation: 'The gentleman was the eldest', notes: 'é•· (zhÇng) means eldest or senior. Being the eldest son carried significant responsibility for the family\'s welfare and ancestral rites. The classical particle ä¹Ÿ marks a declarative statement.' },

            // CHARACTER
            { section: 'youth', chars: 'è‡ªå¹¼å‹¤å¥®æ¨¸å¯¦', translation: 'From youth, diligent and honest', notes: 'è‡ªå¹¼ (zÃ¬yÃ²u) means "from childhood." å‹¤å¥® (qÃ­nfÃ¨n, diligent) and æ¨¸å¯¦ (pÇ”shÃ­, simple and genuine) are cardinal Confucian virtues. This establishes his character was formed early, not merely a result of success.' },
            { section: 'youth', chars: 'å¾ªè¦è¹ˆçŸ©', translation: 'Following rules and walking the proper path', notes: 'A four-character idiom (æˆèª) meaning to follow established norms strictly. å¾ª and è¹ˆ both mean "to follow"; è¦ (compass) and çŸ© (square) represent moral standards. The idiom suggests propriety without rigidity.' },
            { section: 'youth', chars: 'å…ˆå–ªæ¯å¾Œå–ªçˆ¶', translation: 'First lost his mother, then lost his father', notes: 'å–ª (sÃ ng) is the formal term for losing a parent to death. Losing both parents young was considered a great hardship that tested character. This detail explains his early self-reliance and entry into trade.' },
            { section: 'virtues', chars: 'æ¥­å€™æ™‚æ®–è²¨', translation: 'In business, he watched for opportunities and grew his wealth', notes: 'å€™æ™‚ (hÃ²ushÃ­) means "observing the right timing"â€”a key merchant skill. æ®–è²¨ (zhÃ­huÃ²) means "to grow goods/wealth." The phrase presents commercial success as requiring wisdom and patience, not mere greed.' },
            { section: 'virtues', chars: 'æ­²æœ‰å¥‡è´', translation: 'Every year yielded surplus profits', notes: 'å¥‡è´ (jÄ«yÃ­ng) means unexpected or extraordinary profits. The character å¥‡ suggests profits beyond the ordinaryâ€”indicating both business acumen and perhaps divine blessing on his honest dealings.' },
            { section: 'virtues', chars: 'å•†å ´ç¨±ä¿¡ç¾©ç„‰', translation: 'In the marketplace, he was praised for integrity', notes: 'ä¿¡ç¾© (xÃ¬nyÃ¬) combines trustworthiness (ä¿¡) and righteousness (ç¾©)â€”the highest praise for a merchant. In Confucian commercial ethics, profit gained through integrity was honorable; deceptive profit was shameful. ç„‰ is a classical sentence particle.' },
            { section: 'virtues', chars: 'å¥‰è€¶ç©Œæ•™', translation: 'He followed the teachings of Jesus', notes: 'å¥‰ (fÃ¨ng) means to follow or embrace reverently. è€¶ç©Œæ•™ is the Chinese term for Christianity (literally "Jesus teaching"). Protestant missionaries were active in Ningbo from the 1840s. His conversion likely occurred during his years in Shanghai.' },
            { section: 'virtues', chars: 'æ„›äººå¦‚å·±', translation: 'Loved others as himself', notes: 'A direct quote of the biblical commandment (Leviticus 19:18, Matthew 22:39). Its inclusion shows how Christian ethics were presented as compatible with Confucian benevolence (ä»), bridging two moral traditions.' },
            { section: 'virtues', chars: 'æ¨‚å–„å¥½æ–½', translation: 'Delighted in goodness and loved to give', notes: 'A classical four-character phrase (æˆèª) describing philanthropic character. æ¨‚å–„ means "to take joy in virtue"; å¥½æ–½ means "to love giving." This Confucian ideal of the virtuous wealthy man perfectly describes the Christian concept of cheerful giving.' },
            { section: 'virtues', chars: 'è€è€Œä¸å€¦', translation: 'In old age, still untiring', notes: 'è€è€Œä¸å€¦ echoes Confucius\'s self-description. The Analerta 7.19 records him saying he was so dedicated he forgot to eat, so joyful he forgot worries, "ä¸çŸ¥è€ä¹‹å°‡è‡³" (unaware old age was approaching). This phrase presents the subject as tireless in virtue even into old age.' },
            { section: 'virtues', chars: 'åœ¨æ»¬', translation: 'In Shanghai', notes: 'æ»¬ (HÃ¹) is the classical abbreviation for Shanghai, derived from ancient fishing weirs. Many Ningbo merchants made their fortunes in Shanghai during its rapid growth as a treaty port.' },
            { section: 'virtues', chars: 'å¯§æ³¢åŒé„‰æœƒ', translation: 'Ningbo Native-Place Association', notes: 'åŒé„‰æœƒ (tÃ³ngxiÄnghuÃ¬) were mutual-aid organizations for migrants from the same region. The Ningbo association in Shanghai was among the most powerful, providing networking, dispute resolution, and charitable services.' },
            { section: 'virtues', chars: 'å››æ˜å…¬æ‰€', translation: 'Siming Guildhall', notes: 'å››æ˜ (SÃ¬mÃ­ng) is an ancient name for Ningbo, from the Siming Mountains. å…¬æ‰€ (gÅngsuÇ’) were guildhalls that served as community centers, handling everything from business disputes to funeral arrangements for deceased members.' },
            { section: 'virtues', chars: 'å››æ˜é†«é™¢', translation: 'Siming Hospital', notes: 'A hospital serving the Ningbo community in Shanghai. Medical philanthropy was highly valued, as it demonstrated care for the physical welfare of one\'s fellow townsmen regardless of their ability to pay.' },
            { section: 'virtues', chars: 'é’å¹´æœƒ', translation: 'YMCA', notes: 'é’å¹´æœƒ is the Chinese name for the Young Men\'s Christian Association. Its presence here reflects the subject\'s Christian faith and the YMCA\'s significant role in early 20th century Chinese urban life, offering education and social services.' },
            { section: 'virtues', chars: 'ç­‰çš†ç«­èª è³‡åŠ©', translation: 'And other institutions, all sincerely supported', notes: 'ç«­èª  (jiÃ©chÃ©ng) means "with utmost sincerity"â€”emphasizing that his giving was wholehearted, not merely for show. è³‡åŠ© (zÄ«zhÃ¹) means financial support or sponsorship.' },
            { section: 'virtues', chars: 'åœ¨é„‰èˆˆè¾¦å­¸æ ¡', translation: 'In his hometown, he established schools', notes: 'åœ¨é„‰ (zÃ ixiÄng) means "in one\'s home village." èˆˆè¾¦å­¸æ ¡ (xÄ«ngbÃ n xuÃ©xiÃ o) means to found or establish schools. Funding education was among the highest Confucian virtuesâ€”it benefited the community and brought honor to the donor\'s name.' },
            { section: 'virtues', chars: 'ä¿®è‘ºå®—ç¥ ', translation: 'Repaired the ancestral temple', notes: 'ä¿®è‘º (xiÅ«qÃ¬) means to repair or renovate. å®—ç¥  (zÅngcÃ­) is the clan\'s ancestral hall where tablets of ancestors were kept and rituals performed. Maintaining the ancestral hall demonstrated filial piety and commitment to the clan.' },
            { section: 'virtues', chars: 'é›–æ•¸åƒé‡‘ä¸å°‘å', translation: 'Though it cost thousands in gold, he did not stint at all', notes: 'æ•¸åƒé‡‘ (shÃ¹ qiÄnjÄ«n) means "several thousand in gold"â€”a substantial fortune. ä¸å°‘å (bÃ¹ shÇo lÃ¬n) means "not the least bit stingy." This emphasizes that his generosity was wholehearted, not reluctant.' },
            { section: 'virtues', chars: 'è“‹å¤é„‰é‡Œä¹‹å–„äºº', translation: 'Truly a virtuous man of the old village tradition', notes: 'è“‹ (gÃ i) is an emphatic particle meaning "truly" or "indeed." å¤é„‰é‡Œ refers to the traditional village community. å–„äºº (shÃ nrÃ©n) means a virtuous or good personâ€”one who embodies Confucian ideals of benevolence and community service.' },
            { section: 'virtues', chars: 'ä»Šå®—æ•™ä¹‹ä¿¡å¾’ä¹Ÿç„¡æ„§ç„‰', translation: 'And a blameless follower of the modern faith', notes: 'ä»Šå®—æ•™ (jÄ«n zÅngjiÃ o) means "modern religion"â€”i.e., Christianity. ä¿¡å¾’ (xÃ¬ntÃº) means believer or follower. ç„¡æ„§ (wÃºkuÃ¬) means "without shame." This remarkable passage harmonizes Confucian and Christian ethics, presenting them as complementary virtues.' },

            // OCCUPATION
            { section: 'occupation', chars: 'å¹´åä¸‰å³æ£„æ›¸è€Œè³ˆ', translation: 'At age thirteen, he immediately left study for trade', notes: 'æ£„æ›¸ (qÃ¬shÅ«) means "abandoning books"â€”leaving formal education. è€Œè³ˆ (Ã©r gÇ”) means "and became a merchant." Entering trade at 13 was common for families of modest means. The character å³ (jÃ­, immediately) suggests necessity rather than choice.' },
            { section: 'occupation', chars: 'å°±æ¥­æ–¼é„‰ä¹‹äº¬è˜‡é›œè²¨è‚†', translation: 'Took employment at the village\'s Beijing-Suzhou sundries shop', notes: 'äº¬è˜‡é›œè²¨ refers to goods traded between Beijing and Suzhouâ€”a major commercial route. è‚† (sÃ¬) is a classical word for shop. Such shops sold everything from daily necessities to small luxuries.' },
            { section: 'occupation', chars: 'å…¼å”®é¦–é£¾ç·åŒ¹', translation: 'Also sold jewelry and silk fabrics', notes: 'å…¼ (jiÄn) means "additionally." é¦–é£¾ (shÇ’ushi) is jewelry; ç·åŒ¹ (duÃ npÇ) refers to bolts of satin. These higher-value goods suggest the shop served customers with some means.' },
            { section: 'occupation', chars: 'æ—¢ä¸å¾—å¿—', translation: 'Not finding success there', notes: 'ä¸å¾—å¿— (bÃ¹ dÃ© zhÃ¬) is a classical expression meaning "unable to achieve one\'s ambitions." This honest admission of early failure makes his later success more impressive and his character more admirable.' },
            { section: 'occupation', chars: 'å‰‡é§•é‡£èˆ¹æ•é­šæ±Ÿæµ™æµ·ä¸­', translation: 'He then piloted a fishing boat, catching fish in the Jiangsu-Zhejiang seas', notes: 'é§• (jiÃ ) means to pilot or drive. æ±Ÿæµ™æµ·ä¸­ refers to the coastal waters between Jiangsu and Zhejiang provinces. This dramatic career change from shopkeeper to fisherman shows his willingness to do hard physical labor.' },
            { section: 'occupation', chars: 'å¹´ä¸‰åå§‹å®¢ä¸Šæµ·', translation: 'At age thirty, he first sojourned in Shanghai', notes: 'å®¢ (kÃ¨) means "to sojourn" or "to be a guest"â€”implying residence away from one\'s hometown. Shanghai in the late 19th century was booming as a treaty port, attracting ambitious migrants from across China.' },
            { section: 'occupation', chars: 'ç‡Ÿè¡£æ¥­', translation: 'Operated a clothing business', notes: 'ç‡Ÿ (yÃ­ng) means to manage or operate. è¡£æ¥­ (yÄ«yÃ¨) is the clothing trade. The Ningbo merchant community in Shanghai was particularly strong in textiles and tailoring.' },
            { section: 'occupation', chars: 'æ—‹ç¶“ç†ç…¤è™Ÿ', translation: 'Soon afterward managed a coal firm', notes: 'æ—‹ (xuÃ¡n) means "soon" or "before long." ç…¤è™Ÿ (mÃ©ihÃ o) is a coal trading company. Coal was essential fuel for Shanghai\'s growing industries and foreign steamshipsâ€”a lucrative trade.' },
            { section: 'occupation', chars: 'è‡ªæ˜¯çµ‚èº«ä¸€æ¥­', translation: 'From then on, this was his lifelong occupation', notes: 'è‡ªæ˜¯ (zÃ¬shÃ¬) means "from this point on." çµ‚èº«ä¸€æ¥­ emphasizes that he found his calling in the coal trade and remained devoted to it. Stability in one trade was considered virtuous, not limiting.' },

            // FAMILY
            { section: 'family', chars: 'å…ƒé…é™³æ°å‰å’', translation: 'His first wife, nÃ©e Chen, predeceased him', notes: 'å…ƒé… (yuÃ¡npÃ¨i) means "original/first wife." å‰å’ (qiÃ¡nzÃº) means "died before [him]." Women are identified by their maiden surname plus æ° (shÃ¬). The loss of his first wife necessitated remarriage to maintain the household.' },
            { section: 'family', chars: 'ç¹¼é…å´”æ°', translation: 'His second wife, nÃ©e Cui', notes: 'ç¹¼é… (jÃ¬pÃ¨i) means "succeeding wife" or "second wife." Remarriage after a wife\'s death was expected for men, especially those needing heirs. å´” (CuÄ«) was her maiden surname.' },
            { section: 'family', chars: 'å­ä¸‰', translation: 'Three sons', notes: 'å­ (zÇ) means son. Recording the number of male heirs was essential, as sons continued the family line and performed ancestral rites. The number three was considered auspicious.' },
            { section: 'family', chars: 'é•·å’¸éˆé™³å‡ºå…ˆé€', translation: 'The eldest, Xianjun, born of [Madam] Chen, died before [his father]', notes: 'é•· indicates the eldest son. é™³å‡º means "born of the Chen wife." å…ˆé€ (died first) indicates he predeceased his fatherâ€”a great sorrow in Chinese culture, as a son should outlive his parents to care for them.' },
            { section: 'family', chars: 'æ¬¡å’¸é˜ä¸‰å’¸é¾¢çš†å´”å‡º', translation: 'The second, Xianqiang, and the third, Xianheâ€”both born of [Madam] Cui', notes: 'æ¬¡ means second in birth order; ä¸‰ means third. å’¸ (xiÃ¡n) is the shared generation name. çš†å´”å‡º clarifies that these two sons were born of the second wife, Madam Cui.' },
            { section: 'family', chars: 'å¥³å››äºº', translation: 'Four daughters', notes: 'å¥³ (nÇš) means daughter. In traditional genealogies, daughters were recorded but with less detail than sons, as they would marry out and join their husbands\' families. Four was a respectable number.' },
            { section: 'family', chars: 'é©ä½™é Œå¨', translation: '[First daughter] married Yu Songwei', notes: 'é© (shÃ¬) is the classical term for a woman marrying into another family, as opposed to å¨¶ (qÇ”) for a man taking a wife. ä½™ (YÃº) is the husband\'s surname; é Œå¨ (SÃ²ngwÄ“i, "Praising Prestige") is his given name.' },
            { section: 'family', chars: 'é™¸é³³çŸ³', translation: '[Second daughter married] Lu Fengshi', notes: 'The verb é© is implied from context. é™¸ (LÃ¹) is a common surname; é³³çŸ³ (FÃ¨ngshÃ­, "Phoenix Stone") is an elegant given name combining auspicious imagery.' },
            { section: 'family', chars: 'ä¸‰å››å¾…å­—', translation: 'The third and fourth [daughters] are awaiting marriage', notes: 'å¾…å­— (dÃ izÃ¬) literally means "awaiting the character"â€”an elegant classical expression for unmarried young women. It refers to the courtesy name a woman would receive at marriage, symbolizing her new identity in her husband\'s family.' },
            { section: 'family', chars: 'å­«å››äººæ­£éµ æ­£éµ¬æ­£é´»æ­£é¶´', translation: 'Four grandsons: Zhenghu, Zhengpeng, Zhenghong, Zhenghe', notes: 'All grandsons share the generation name æ­£ (zhÃ¨ng, "upright/correct"). Their second characters are all auspicious birds: éµ  (hÃº, swan), éµ¬ (pÃ©ng, mythical roc), é´» (hÃ³ng, wild goose), é¶´ (hÃ¨, crane)â€”symbolizing lofty aspirations and longevity.' },
            { section: 'family', chars: 'å…¬ç”Ÿ', translation: 'The gentleman was born...', notes: 'This transitional phrase links the family section to the birth/death dates. å…¬ (gÅng) is the honorific used throughout the document for the deceased subject.' },

            // DEATH
            { section: 'death', chars: 'æ–¼å‰æ¸…åŒæ²»å››å¹´ä¹™ä¸‘ä¹æœˆäºŒåä¸ƒæ—¥', translation: 'On the 27th day of the 9th month of Tongzhi 4, yichou year [October 1865]', notes: 'å‰æ¸… (former Qing) indicates this was written after the 1911 revolution that ended the dynasty. åŒæ²» was the reign of the Tongzhi Emperor (r. 1861-1875). ä¹™ä¸‘ is the sexagenary cycle year designation.' },
            { section: 'death', chars: 'æ­²ç”²å­å¹´æ­£å…­å', translation: 'At the age of jiazi, exactly sixty years old', notes: 'ç”²å­ (jiazi) is both the first year in the 60-year cycle AND a term for completing 60 yearsâ€”a full cycle of life. Reaching 60 was a major milestone celebrated as é‚„æ›† (returning calendar).' },
            { section: 'death', chars: ' æœˆç‡Ÿç”Ÿå£™æ–¼å¤©', translation: 'In [?] month, [he] prepared his burial site at Tian[feng Mountain]', notes: 'The month is left blank in the originalâ€”possibly to be filled in later or because the exact date was uncertain. ç‡Ÿç”Ÿå£™ means to prepare one\'s tomb while still aliveâ€”a common practice among the wealthy to ensure proper burial.' },

            // BURIAL
            { section: 'burial', chars: 'é³³å±±éº“', translation: 'At the foot of Phoenix Mountain', notes: 'é³³å±± (FÃ¨ngshÄn, Phoenix Mountain) is an extremely auspicious name for a burial site. éº“ (lÃ¹) means the foot or base of a mountainâ€”a favored location in feng shui, sheltered yet accessible.' },
            { section: 'burial', chars: 'å¢“å‘å', translation: 'The tomb sits facing...', notes: 'This introduces the feng shui orientation. å‘ (xiÃ ng) is the direction the tomb faces; å (zuÃ²) is the direction its back faces. Proper orientation was crucial for channeling beneficial qi.' },
            { section: 'burial', chars: 'å‘', translation: '[Facing direction]', notes: 'Part of the compass orientation. å‘ (xiÃ ng) indicates the direction the tomb faces. The specific direction character would follow.' },
            { section: 'burial', chars: 'å…¼', translation: '[Combined with]', notes: 'å…¼ (jiÄn) in feng shui compass readings means "combined with" or "also including." It indicates a compound directionâ€”the tomb faces primarily one direction but includes aspects of an adjacent direction on the compass.' },
            { section: 'burial', chars: 'å±±ç’°æ°´æŠ±', translation: 'Mountains encircle, water embraces', notes: 'The ideal feng shui configuration: mountains behind for protection, water in front for gathering wealth and qi. This four-character phrase describes the "armchair" formation prized by geomancers.' },
            { section: 'burial', chars: 'ç•¶è”­å…¶å—£äºº', translation: 'Shall bestow blessings upon his descendants', notes: 'è”­ (yÃ¬n) means shade or protectionâ€”here metaphorically, the blessings ancestors extend to descendants. The belief that proper burial benefits future generations was central to feng shui practice.' },
            { section: 'burial', chars: 'å¤©é³³ä¹‹å±±å½¢å‹¢é£›ç¿”', translation: 'Tianfeng Mountain has the form and momentum of a phoenix in flight', notes: 'å¤©é³³ (TiÄnfÃ¨ng, Heavenly Phoenix) is the mountain\'s name. å½¢å‹¢ (xÃ­ngshÃ¬) means form and momentumâ€”key feng shui concepts. A site resembling a phoenix in flight was considered supremely auspicious.' },
            { section: 'burial', chars: 'è¯é‡‡ç¿¼ç¿¼', translation: 'With magnificent plumage, wings spread wide', notes: 'è¯é‡‡ (huÃ¡cÇi) means splendid colors or plumage. ç¿¼ç¿¼ (yÃ¬yÃ¬) is a reduplicated form meaning "with wings spread" or "flapping continuously"â€”creating vivid imagery of the phoenix taking flight.' },
            { section: 'burial', chars: 'å’Œé³´é˜é˜', translation: 'Singing harmoniously, ringing clear', notes: 'å’Œé³´ (hÃ©mÃ­ng) means harmonious calls. é˜é˜ (qiÄngqiÄng) is onomatopoeia for the ringing cry of the phoenixâ€”a sound said to bring peace and prosperity.' },
            { section: 'burial', chars: 'åœå‰æ–¼æ­¤', translation: 'This spot was divined as auspicious', notes: 'åœ (bÇ”) means to divine or consult oracles. å‰ (jÃ­) means auspicious. A professional geomancer (é¢¨æ°´å¸«) would have been consulted to select this propitious site.' },
            { section: 'burial', chars: 'å­å­«ç¹æ˜Œ', translation: 'His descendants shall flourish', notes: 'ç¹æ˜Œ (fÃ¡nchÄng) means to flourish abundantly. This is the promised benefit of auspicious burialâ€”the ancestor\'s favorable resting place will bring prosperity to future generations.' },
            { section: 'burial', chars: 'ç™¾æ­²ä¹‹å¾Œå…¶', translation: 'After a hundred years, he shall...', notes: 'ç™¾æ­²ä¹‹å¾Œ (bÇisuÃ¬ zhÄ« hÃ²u) is a elegant euphemism for death, literally "after a hundred years." Chinese culture avoided direct references to death, preferring such circumlocutions.' },
            { section: 'burial', chars: 'æ­¸å…¶è—', translation: 'Return to his final resting place', notes: 'æ­¸ (guÄ«) means to return home. è— (zÃ ng) means burial place or to be interred. The phrase suggests death as a homecoming, a peaceful return to the earth.' },

            // CREDIT
            { section: 'credit', chars: 'åŒé‚‘å¼µç¾ç¿Šæ’°æ–‡', translation: 'Text composed by Zhang Meiyi of the same district', notes: 'åŒé‚‘ (tÃ³ngyÃ¬) means "from the same county." å¼µç¾ç¿Š (ZhÄng MÄ›iyÃ¬, 1856-1924) was a distinguished Ningbo scholar and calligrapher. æ’°æ–‡ (zhuÃ nwÃ©n) means to compose the text.' },
            { section: 'credit', chars: 'æ›¸ä¸¹', translation: 'Written in cinnabar', notes: 'æ›¸ä¸¹ (shÅ«dÄn) means to write in red cinnabar ink. This was the traditional method for preparing text for stone carvingâ€”the calligrapher wrote the characters in red ink directly on the stone, then carvers followed the lines.' }
        ];

        // Character dictionary
        const characterData = {
            ' ': { pinyin: '(blank)', meaning: 'Intentional blank space', context: 'The original document has a blank space here where a month number would goâ€”possibly left to be filled in later, or because the exact date was uncertain.' },
            'å¥': { pinyin: 'gÅu', meaning: 'Phrase; place name component', context: 'Part of Gouyu (å¥ä¿), ancient name for Siming Mountains region.' },
            'ä¿': { pinyin: 'yÃº', meaning: 'Surname; to consent', context: 'Part of Gouyu (å¥ä¿).' },
            'å®—': { pinyin: 'zÅng', meaning: 'Clan, ancestors, lineage', context: 'In å®—è­œ (clan genealogy).' },
            'è­œ': { pinyin: 'pÇ”', meaning: 'Register, genealogy', context: 'å®—è­œ is a clan\'s genealogical record.' },
            'å·': { pinyin: 'juÃ n', meaning: 'Volume, scroll', context: 'Volume number.' },
            'å…­': { pinyin: 'liÃ¹', meaning: 'Six', context: 'Volume 6.' },
            'æ­£': { pinyin: 'zhÃ¨ng', meaning: 'Correct, orthodox', context: 'In æ­£å§‹å ‚, suggests orthodox tradition.' },
            'å§‹': { pinyin: 'shÇ', meaning: 'Beginning, origin', context: 'Part of hall name æ­£å§‹å ‚.' },
            'å ‚': { pinyin: 'tÃ¡ng', meaning: 'Hall', context: 'å ‚è™Ÿ distinguishes family branches.' },
            'é®‘': { pinyin: 'bÃ o', meaning: 'Surname Bao; salted fish', context: 'The family surname, prominent in Ningbo.' },
            'å…¬': { pinyin: 'gÅng', meaning: 'Honorific: gentleman, sir', context: 'Respectful title for the deceased.' },
            'æ†': { pinyin: 'hÃ©ng', meaning: 'Constant, persevering', context: 'Part of courtesy name æ†é½‹.' },
            'é½‹': { pinyin: 'zhÄi', meaning: 'Studio, study', context: 'Common in scholarly names.' },
            'ç”Ÿ': { pinyin: 'shÄ“ng', meaning: 'Life, living', context: 'In ç”Ÿå£™, tomb prepared during lifetime.' },
            'å£™': { pinyin: 'kuÃ ng', meaning: 'Tomb, burial pit', context: 'å£™å¿— is a tomb inscription.' },
            'å¿—': { pinyin: 'zhÃ¬', meaning: 'Record, annals', context: 'å£™å¿— = burial record.' },
            'å': { pinyin: 'mÃ­ng', meaning: 'Name, personal name', context: 'Given name used by elders.' },
            'å“²': { pinyin: 'zhÃ©', meaning: 'Wise, sagacious', context: 'Part of name Zhetai (å“²æ³°).' },
            'æ³°': { pinyin: 'tÃ i', meaning: 'Great, peaceful', context: 'Part of personal name.' },
            'å­—': { pinyin: 'zÃ¬', meaning: 'Courtesy name', context: 'Given at age 20.' },
            'å§“': { pinyin: 'xÃ¬ng', meaning: 'Surname', context: 'Introduces family name.' },
            'æ°': { pinyin: 'shÃ¬', meaning: 'Clan suffix', context: 'Added after surnames formally.' },
            'ä¸–': { pinyin: 'shÃ¬', meaning: 'Generation', context: 'ä¸–ç¯¤ = devoted for generations.' },
            'ç¯¤': { pinyin: 'dÇ”', meaning: 'Sincere, devoted', context: 'Generations of attachment to homeland.' },
            'é„': { pinyin: 'yÃ­n', meaning: 'Yin County', context: 'Now part of Ningbo, Zhejiang.' },
            'å—': { pinyin: 'nÃ¡n', meaning: 'South', context: 'é„å— = southern Yin County.' },
            'å¡˜': { pinyin: 'tÃ¡ng', meaning: 'Pond, embankment', context: 'Part of Nantang Township.' },
            'é„‰': { pinyin: 'xiÄng', meaning: 'Township, village', context: 'Rural administrative unit.' },
            'å®¶': { pinyin: 'jiÄ', meaning: 'Family, home', context: 'Part of village name.' },
            'åŸ­': { pinyin: 'dÃ i', meaning: 'Dam, embankment', context: 'Common in Jiangnan place names.' },
            'äºº': { pinyin: 'rÃ©n', meaning: 'Person', context: 'Xäºº = person from X place.' },
            'æ›¾': { pinyin: 'zÄ“ng', meaning: 'Great (generational)', context: 'æ›¾ç¥– = great-grandfather.' },
            'ç¥–': { pinyin: 'zÇ”', meaning: 'Grandfather, ancestor', context: 'Used for male ancestors.' },
            'å»·': { pinyin: 'tÃ­ng', meaning: 'Court, hall', context: 'Part of great-grandfather\'s name.' },
            'æš': { pinyin: 'yÃ¡ng', meaning: 'To raise, spread', context: 'Part of ancestor\'s name.' },
            'å…‰': { pinyin: 'guÄng', meaning: 'Light, glory', context: 'Part of grandfather\'s name å…‰è¯.' },
            'è¯': { pinyin: 'huÃ¡', meaning: 'Splendid, China', context: 'å…‰è¯ = glory and splendor.' },
            'çˆ¶': { pinyin: 'fÃ¹', meaning: 'Father', context: 'Introduces father\'s name.' },
            'æ˜': { pinyin: 'mÃ­ng', meaning: 'Bright', context: 'Part of father\'s name.' },
            'æ˜Œ': { pinyin: 'chÄng', meaning: 'Prosperous', context: 'æ˜æ˜Œ = bright and prosperous.' },
            'æ¯': { pinyin: 'mÇ”', meaning: 'Mother', context: 'Introduces mother\'s family.' },
            'ä¾¯': { pinyin: 'hÃ³u', meaning: 'Marquis; surname', context: 'Mother\'s maiden surname.' },
            'å…„': { pinyin: 'xiÅng', meaning: 'Elder brother', context: 'å…„å¼Ÿ = brothers.' },
            'å¼Ÿ': { pinyin: 'dÃ¬', meaning: 'Younger brother', context: 'Part of å…„å¼Ÿ.' },
            'äºŒ': { pinyin: 'Ã¨r', meaning: 'Two', context: 'Two brothers.' },
            'å…¶': { pinyin: 'qÃ­', meaning: 'His, he', context: 'Pronoun for the subject.' },
            'é•·': { pinyin: 'zhÇng', meaning: 'Eldest', context: 'Senior position among siblings.' },
            'ä¹Ÿ': { pinyin: 'yÄ›', meaning: '(Particle)', context: 'Classical sentence ending.' },
            'è‡ª': { pinyin: 'zÃ¬', meaning: 'Self, from', context: 'è‡ªå¹¼ = from childhood.' },
            'å¹¼': { pinyin: 'yÃ²u', meaning: 'Young', context: 'Emphasizes lifelong good character.' },
            'å‹¤': { pinyin: 'qÃ­n', meaning: 'Diligent', context: 'å‹¤å¥® = hardworking.' },
            'å¥®': { pinyin: 'fÃ¨n', meaning: 'To strive', context: 'Part of å‹¤å¥®.' },
            'æ¨¸': { pinyin: 'pÇ”', meaning: 'Simple, plain', context: 'æ¨¸å¯¦ = simple and genuine.' },
            'å¯¦': { pinyin: 'shÃ­', meaning: 'Real, honest', context: 'A person of sincerity.' },
            'å¾ª': { pinyin: 'xÃºn', meaning: 'To follow', context: 'å¾ªè¦è¹ˆçŸ© = follow rules.' },
            'è¦': { pinyin: 'guÄ«', meaning: 'Rule', context: 'Part of idiom.' },
            'è¹ˆ': { pinyin: 'dÇo', meaning: 'To tread', context: 'è¹ˆçŸ© = walk properly.' },
            'çŸ©': { pinyin: 'jÇ”', meaning: 'Square, norm', context: 'Metaphor for standards.' },
            'å…ˆ': { pinyin: 'xiÄn', meaning: 'First', context: 'å…ˆå–ªæ¯ = first lost mother.' },
            'å–ª': { pinyin: 'sÃ ng', meaning: 'To lose (death)', context: 'Death of relatives.' },
            'å¾Œ': { pinyin: 'hÃ²u', meaning: 'After', context: 'å¾Œå–ªçˆ¶ = later lost father.' },
            'å¤©': { pinyin: 'tiÄn', meaning: 'Heaven, sky', context: 'å¤©é³³å±± = Heavenly Phoenix Mountain.' },
            'é³³': { pinyin: 'fÃ¨ng', meaning: 'Phoenix', context: 'Auspicious burial mountain name.' },
            'å±±': { pinyin: 'shÄn', meaning: 'Mountain', context: 'Burial location.' },
            'éº“': { pinyin: 'lÃ¹', meaning: 'Foot of mountain', context: 'Base of the mountain.' },
            'å¢“': { pinyin: 'mÃ¹', meaning: 'Tomb', context: 'His burial place.' },
            'å‘': { pinyin: 'xiÃ ng', meaning: 'Direction, facing', context: 'Feng shui orientation.' },
            'å': { pinyin: 'zuÃ²', meaning: 'To sit; back direction', context: 'Tomb\'s back faces this way.' },
            'å…¼': { pinyin: 'jiÄn', meaning: 'Also, combined', context: 'Compound compass direction.' },
            'ç’°': { pinyin: 'huÃ¡n', meaning: 'To surround', context: 'å±±ç’° = mountains encircle.' },
            'æ°´': { pinyin: 'shuÇ', meaning: 'Water', context: 'æ°´æŠ± = water embraces.' },
            'æŠ±': { pinyin: 'bÃ o', meaning: 'To embrace', context: 'Water wrapping around site.' },
            'ç•¶': { pinyin: 'dÄng', meaning: 'Should, shall', context: 'ç•¶è”­ = shall bless.' },
            'è”­': { pinyin: 'yÃ¬n', meaning: 'Shade, bless', context: 'Ancestral blessing to descendants.' },
            'å—£': { pinyin: 'sÃ¬', meaning: 'Heir, descendant', context: 'å—£äºº = heirs.' },
            'å½¢': { pinyin: 'xÃ­ng', meaning: 'Form, shape', context: 'å½¢å‹¢ = terrain configuration.' },
            'å‹¢': { pinyin: 'shÃ¬', meaning: 'Momentum, terrain', context: 'Mountain\'s dynamic form.' },
            'é£›': { pinyin: 'fÄ“i', meaning: 'To fly', context: 'é£›ç¿” = soaring flight.' },
            'ç¿”': { pinyin: 'xiÃ¡ng', meaning: 'To soar', context: 'Like a phoenix in flight.' },
            'é‡‡': { pinyin: 'cÇi', meaning: 'Color, plumage', context: 'è¯é‡‡ = splendid plumage.' },
            'ç¿¼': { pinyin: 'yÃ¬', meaning: 'Wing', context: 'ç¿¼ç¿¼ = flapping wings.' },
            'å’Œ': { pinyin: 'hÃ©', meaning: 'Harmony', context: 'å’Œé³´ = harmonious calls.' },
            'é³´': { pinyin: 'mÃ­ng', meaning: 'To call (bird)', context: 'Phoenix\'s song.' },
            'é˜': { pinyin: 'qiÄng', meaning: 'Clang, ring', context: 'Onomatopoeia for phoenix cry.' },
            'åœ': { pinyin: 'bÇ”', meaning: 'To divine', context: 'åœå‰ = divined as auspicious.' },
            'å‰': { pinyin: 'jÃ­', meaning: 'Auspicious', context: 'Favorable omen.' },
            'æ­¤': { pinyin: 'cÇ', meaning: 'This, here', context: 'æ–¼æ­¤ = at this place.' },
            'å­': { pinyin: 'zÇ', meaning: 'Son, child', context: 'å­å­« = descendants.' },
            'å­«': { pinyin: 'sÅ«n', meaning: 'Grandson', context: 'Grandchildren.' },
            'ç¹': { pinyin: 'fÃ¡n', meaning: 'Flourishing', context: 'ç¹æ˜Œ = flourishing.' },
            'ç™¾': { pinyin: 'bÇi', meaning: 'Hundred', context: 'ç™¾æ­² = euphemism for death.' },
            'æ­²': { pinyin: 'suÃ¬', meaning: 'Year, age', context: 'ç™¾æ­²ä¹‹å¾Œ = after death.' },
            'ä¹‹': { pinyin: 'zhÄ«', meaning: 'Of, \'s', context: 'Classical possessive.' },
            'æ­¸': { pinyin: 'guÄ«', meaning: 'To return', context: 'æ­¸å…¶è— = return to resting place.' },
            'è—': { pinyin: 'cÃ¡ng/zÃ ng', meaning: 'To hide; burial place', context: 'Final resting place.' },
            'åŒ': { pinyin: 'tÃ³ng', meaning: 'Same', context: 'åŒé‚‘ = same district.' },
            'é‚‘': { pinyin: 'yÃ¬', meaning: 'District, town', context: 'From same district.' },
            'å¼µ': { pinyin: 'zhÄng', meaning: 'Zhang (surname)', context: 'Author\'s surname.' },
            'ç¾': { pinyin: 'mÄ›i', meaning: 'Beautiful', context: 'Part of author\'s name.' },
            'ç¿Š': { pinyin: 'yÃ¬', meaning: 'To assist', context: 'Part of author\'s name.' },
            'æ’°': { pinyin: 'zhuÃ n', meaning: 'To compose', context: 'æ’°æ–‡ = composed text.' },
            'æ–‡': { pinyin: 'wÃ©n', meaning: 'Text, writing', context: 'The written composition.' },
            'æ›¸': { pinyin: 'shÅ«', meaning: 'To write', context: 'æ›¸ä¸¹ = wrote in cinnabar.' },
            'ä¸¹': { pinyin: 'dÄn', meaning: 'Cinnabar, red', context: 'Red ink for stone inscriptions.' },
            'æ–¼': { pinyin: 'yÃº', meaning: 'At, in', context: 'Classical preposition.' },
            'å‰': { pinyin: 'qiÃ¡n', meaning: 'Before, former', context: 'å‰æ¸… = former Qing.' },
            'æ¸…': { pinyin: 'qÄ«ng', meaning: 'Qing dynasty', context: 'Written after 1911 revolution.' },
            'æ²»': { pinyin: 'zhÃ¬', meaning: 'To govern', context: 'åŒæ²» = Tongzhi Emperor.' },
            'å››': { pinyin: 'sÃ¬', meaning: 'Four', context: 'Year 4.' },
            'å¹´': { pinyin: 'niÃ¡n', meaning: 'Year', context: 'Date component.' },
            'ä¹™': { pinyin: 'yÇ', meaning: 'Second Stem', context: 'Sexagenary cycle.' },
            'ä¸‘': { pinyin: 'chÇ’u', meaning: 'Second Branch', context: 'ä¹™ä¸‘ = 1865.' },
            'ä¹': { pinyin: 'jiÇ”', meaning: 'Nine', context: 'ä¹æœˆ = 9th month.' },
            'æœˆ': { pinyin: 'yuÃ¨', meaning: 'Month', context: 'Date component.' },
            'å': { pinyin: 'shÃ­', meaning: 'Ten', context: 'Number.' },
            'ä¸ƒ': { pinyin: 'qÄ«', meaning: 'Seven', context: 'äºŒåä¸ƒ = 27.' },
            'æ—¥': { pinyin: 'rÃ¬', meaning: 'Day', context: 'Date component.' },
            'ç”²': { pinyin: 'jiÇ', meaning: 'First Stem', context: 'Sexagenary cycle.' },
            'ä¸€': { pinyin: 'yÄ«', meaning: 'One', context: 'Number.' },
            'ç‡Ÿ': { pinyin: 'yÃ­ng', meaning: 'To manage', context: 'ç‡Ÿç”Ÿå£™ = prepared tomb.' },
            'æ¥­': { pinyin: 'yÃ¨', meaning: 'Business, occupation', context: 'Trade and livelihood.' },
            'ä¸‰': { pinyin: 'sÄn', meaning: 'Three', context: 'Number.' },
            'å³': { pinyin: 'jÃ­', meaning: 'Immediately', context: 'å³æ£„æ›¸ = immediately left studies.' },
            'æ£„': { pinyin: 'qÃ¬', meaning: 'To abandon', context: 'Left school.' },
            'è€Œ': { pinyin: 'Ã©r', meaning: 'And, but', context: 'Classical conjunction.' },
            'è³ˆ': { pinyin: 'gÇ”', meaning: 'Merchant', context: 'è€Œè³ˆ = became merchant.' },
            'å°±': { pinyin: 'jiÃ¹', meaning: 'To go to', context: 'å°±æ¥­ = took employment.' },
            'äº¬': { pinyin: 'jÄ«ng', meaning: 'Capital', context: 'äº¬è˜‡ = Beijing-Suzhou trade.' },
            'è˜‡': { pinyin: 'sÅ«', meaning: 'Suzhou', context: 'Regional trade goods.' },
            'é›œ': { pinyin: 'zÃ¡', meaning: 'Mixed', context: 'é›œè²¨ = sundries.' },
            'è²¨': { pinyin: 'huÃ²', meaning: 'Goods', context: 'Merchandise.' },
            'è‚†': { pinyin: 'sÃ¬', meaning: 'Shop', context: 'é›œè²¨è‚† = general store.' },
            'å”®': { pinyin: 'shÃ²u', meaning: 'To sell', context: 'å…¼å”® = also sold.' },
            'é¦–': { pinyin: 'shÇ’u', meaning: 'Head; jewelry', context: 'é¦–é£¾ = jewelry.' },
            'é£¾': { pinyin: 'shÃ¬', meaning: 'Ornament', context: 'Part of é¦–é£¾.' },
            'ç·': { pinyin: 'duÃ n', meaning: 'Satin', context: 'ç·åŒ¹ = silk fabric.' },
            'åŒ¹': { pinyin: 'pÇ', meaning: 'Bolt (cloth)', context: 'Unit for fabric.' },
            'æ—¢': { pinyin: 'jÃ¬', meaning: 'Already, since', context: 'æ—¢ä¸å¾—å¿— = didn\'t succeed.' },
            'å¾—': { pinyin: 'dÃ©', meaning: 'To get', context: 'ä¸å¾—å¿— = didn\'t achieve.' },
            'å‰‡': { pinyin: 'zÃ©', meaning: 'Then', context: 'Logical connector.' },
            'é§•': { pinyin: 'jiÃ ', meaning: 'To pilot', context: 'é§•é‡£èˆ¹ = piloted fishing boat.' },
            'é‡£': { pinyin: 'diÃ o', meaning: 'To fish', context: 'Fishing livelihood.' },
            'èˆ¹': { pinyin: 'chuÃ¡n', meaning: 'Boat', context: 'Fishing vessel.' },
            'æ•': { pinyin: 'bÇ”', meaning: 'To catch', context: 'æ•é­š = catch fish.' },
            'é­š': { pinyin: 'yÃº', meaning: 'Fish', context: 'His catch.' },
            'æ±Ÿ': { pinyin: 'jiÄng', meaning: 'River; Jiangsu', context: 'æ±Ÿæµ™ = Jiangsu-Zhejiang.' },
            'æµ™': { pinyin: 'zhÃ¨', meaning: 'Zhejiang', context: 'Coastal region.' },
            'æµ·': { pinyin: 'hÇi', meaning: 'Sea', context: 'Maritime fishing.' },
            'ä¸­': { pinyin: 'zhÅng', meaning: 'Middle, in', context: 'æµ·ä¸­ = in the sea.' },
            'å®¢': { pinyin: 'kÃ¨', meaning: 'Guest, sojourner', context: 'å®¢ä¸Šæµ· = sojourned in Shanghai.' },
            'ä¸Š': { pinyin: 'shÃ ng', meaning: 'Up; Shanghai', context: 'ä¸Šæµ· = Shanghai.' },
            'è¡£': { pinyin: 'yÄ«', meaning: 'Clothing', context: 'è¡£æ¥­ = clothing trade.' },
            'æ—‹': { pinyin: 'xuÃ¡n', meaning: 'Soon', context: 'æ—‹ç¶“ç† = soon managed.' },
            'ç¶“': { pinyin: 'jÄ«ng', meaning: 'To manage', context: 'ç¶“ç† = to manage.' },
            'ç†': { pinyin: 'lÇ', meaning: 'To manage', context: 'Business management.' },
            'ç…¤': { pinyin: 'mÃ©i', meaning: 'Coal', context: 'ç…¤è™Ÿ = coal firm.' },
            'è™Ÿ': { pinyin: 'hÃ o', meaning: 'Firm, shop', context: 'Business establishment.' },
            'æ˜¯': { pinyin: 'shÃ¬', meaning: 'This, is', context: 'è‡ªæ˜¯ = from then on.' },
            'çµ‚': { pinyin: 'zhÅng', meaning: 'End, final', context: 'çµ‚èº« = lifelong.' },
            'èº«': { pinyin: 'shÄ“n', meaning: 'Body, life', context: 'çµ‚èº«ä¸€æ¥­ = one occupation.' },
            'å€™': { pinyin: 'hÃ²u', meaning: 'To wait', context: 'å€™æ™‚ = watch for timing.' },
            'æ™‚': { pinyin: 'shÃ­', meaning: 'Time', context: 'Right timing.' },
            'æ®–': { pinyin: 'zhÃ­', meaning: 'To grow', context: 'æ®–è²¨ = grow wealth.' },
            'æœ‰': { pinyin: 'yÇ’u', meaning: 'To have', context: 'Common verb.' },
            'å¥‡': { pinyin: 'jÄ«', meaning: 'Surplus', context: 'å¥‡è´ = surplus profits.' },
            'è´': { pinyin: 'yÃ­ng', meaning: 'Profit', context: 'Business profits.' },
            'å•†': { pinyin: 'shÄng', meaning: 'Commerce', context: 'å•†å ´ = marketplace.' },
            'å ´': { pinyin: 'chÇng', meaning: 'Field, market', context: 'Place of commerce.' },
            'ç¨±': { pinyin: 'chÄ“ng', meaning: 'To praise', context: 'ç¨±ä¿¡ç¾© = praised for integrity.' },
            'ä¿¡': { pinyin: 'xÃ¬n', meaning: 'Trust', context: 'ä¿¡ç¾© = integrity.' },
            'ç¾©': { pinyin: 'yÃ¬', meaning: 'Righteousness', context: 'Moral principle.' },
            'ç„‰': { pinyin: 'yÄn', meaning: '(Particle)', context: 'Sentence ending.' },
            'å¥‰': { pinyin: 'fÃ¨ng', meaning: 'To follow', context: 'å¥‰è€¶ç©Œæ•™ = followed Christianity.' },
            'è€¶': { pinyin: 'yÄ“', meaning: '(Phonetic)', context: 'Part of è€¶ç©Œ (Jesus).' },
            'ç©Œ': { pinyin: 'sÅ«', meaning: '(Phonetic)', context: 'Part of è€¶ç©Œ.' },
            'æ•™': { pinyin: 'jiÃ o', meaning: 'Teaching, religion', context: 'è€¶ç©Œæ•™ = Christianity.' },
            'æ„›': { pinyin: 'Ã i', meaning: 'Love', context: 'æ„›äººå¦‚å·± = love others as self.' },
            'å¦‚': { pinyin: 'rÃº', meaning: 'Like, as', context: 'Comparison.' },
            'å·±': { pinyin: 'jÇ', meaning: 'Self', context: 'The Golden Rule.' },
            'æ¨‚': { pinyin: 'lÃ¨', meaning: 'Joy; to delight', context: 'æ¨‚å–„ = delight in good.' },
            'å–„': { pinyin: 'shÃ n', meaning: 'Good, virtuous', context: 'Moral goodness.' },
            'å¥½': { pinyin: 'hÃ o', meaning: 'To love', context: 'å¥½æ–½ = loves to give.' },
            'æ–½': { pinyin: 'shÄ«', meaning: 'To give', context: 'Charitable giving.' },
            'è€': { pinyin: 'lÇo', meaning: 'Old', context: 'è€è€Œä¸å€¦ = untiring in old age.' },
            'ä¸': { pinyin: 'bÃ¹', meaning: 'Not', context: 'Negation.' },
            'å€¦': { pinyin: 'juÃ n', meaning: 'Tired', context: 'ä¸å€¦ = untiring.' },
            'åœ¨': { pinyin: 'zÃ i', meaning: 'At, in', context: 'Location.' },
            'æ»¬': { pinyin: 'hÃ¹', meaning: 'Shanghai', context: 'åœ¨æ»¬ = in Shanghai.' },
            'å¯§': { pinyin: 'nÃ­ng', meaning: 'Ningbo', context: 'å¯§æ³¢ = Ningbo city.' },
            'æ³¢': { pinyin: 'bÅ', meaning: 'Wave; Ningbo', context: 'Part of Ningbo.' },
            'æœƒ': { pinyin: 'huÃ¬', meaning: 'Association', context: 'åŒé„‰æœƒ = native-place association.' },
            'æ‰€': { pinyin: 'suÇ’', meaning: 'Place', context: 'å…¬æ‰€ = guild hall.' },
            'é†«': { pinyin: 'yÄ«', meaning: 'Medicine', context: 'é†«é™¢ = hospital.' },
            'é™¢': { pinyin: 'yuÃ n', meaning: 'Institution', context: 'Part of é†«é™¢.' },
            'é’': { pinyin: 'qÄ«ng', meaning: 'Young', context: 'é’å¹´æœƒ = YMCA.' },
            'ç­‰': { pinyin: 'dÄ›ng', meaning: 'Etc.', context: 'And so forth.' },
            'çš†': { pinyin: 'jiÄ“', meaning: 'All', context: 'çš†ç«­èª  = all sincerely.' },
            'ç«­': { pinyin: 'jiÃ©', meaning: 'To exhaust', context: 'ç«­èª  = with utmost sincerity.' },
            'èª ': { pinyin: 'chÃ©ng', meaning: 'Sincere', context: 'Sincerity in giving.' },
            'è³‡': { pinyin: 'zÄ«', meaning: 'Resources', context: 'è³‡åŠ© = financially support.' },
            'åŠ©': { pinyin: 'zhÃ¹', meaning: 'To help', context: 'Aid and support.' },
            'èˆˆ': { pinyin: 'xÄ«ng', meaning: 'To start', context: 'èˆˆè¾¦ = to establish.' },
            'è¾¦': { pinyin: 'bÃ n', meaning: 'To do', context: 'èˆˆè¾¦å­¸æ ¡ = established schools.' },
            'å­¸': { pinyin: 'xuÃ©', meaning: 'To study', context: 'å­¸æ ¡ = school.' },
            'æ ¡': { pinyin: 'xiÃ o', meaning: 'School', context: 'Educational institution.' },
            'ä¿®': { pinyin: 'xiÅ«', meaning: 'To repair', context: 'ä¿®è‘º = repair.' },
            'è‘º': { pinyin: 'qÃ¬', meaning: 'To thatch', context: 'Repair of buildings.' },
            'ç¥ ': { pinyin: 'cÃ­', meaning: 'Ancestral temple', context: 'å®—ç¥  = clan hall.' },
            'é›–': { pinyin: 'suÄ«', meaning: 'Although', context: 'Concessive.' },
            'æ•¸': { pinyin: 'shÃ¹', meaning: 'Several', context: 'æ•¸åƒé‡‘ = thousands in gold.' },
            'åƒ': { pinyin: 'qiÄn', meaning: 'Thousand', context: 'Large sum.' },
            'é‡‘': { pinyin: 'jÄ«n', meaning: 'Gold, money', context: 'Currency.' },
            'å°‘': { pinyin: 'shÇo', meaning: 'Little', context: 'ä¸å°‘å = did not stint.' },
            'å': { pinyin: 'lÃ¬n', meaning: 'Stingy', context: 'He was not miserly.' },
            'è“‹': { pinyin: 'gÃ i', meaning: 'Indeed, truly', context: 'Emphatic.' },
            'å¤': { pinyin: 'gÇ”', meaning: 'Ancient', context: 'å¤é„‰é‡Œ = old village tradition.' },
            'é‡Œ': { pinyin: 'lÇ', meaning: 'Village', context: 'é„‰é‡Œ = community.' },
            'ä»Š': { pinyin: 'jÄ«n', meaning: 'Now', context: 'ä»Šå®—æ•™ = modern religious.' },
            'å¾’': { pinyin: 'tÃº', meaning: 'Follower', context: 'ä¿¡å¾’ = believer.' },
            'ç„¡': { pinyin: 'wÃº', meaning: 'Without', context: 'ç„¡æ„§ = without shame.' },
            'æ„§': { pinyin: 'kuÃ¬', meaning: 'Ashamed', context: 'He lived blamelessly.' },
            'å…ƒ': { pinyin: 'yuÃ¡n', meaning: 'First, original', context: 'å…ƒé… = first wife.' },
            'é…': { pinyin: 'pÃ¨i', meaning: 'Spouse', context: 'å…ƒé… = first wife.' },
            'é™³': { pinyin: 'chÃ©n', meaning: 'Chen (surname)', context: 'First wife\'s surname.' },
            'å’': { pinyin: 'zÃº', meaning: 'To die', context: 'Respectful term for death.' },
            'ç¹¼': { pinyin: 'jÃ¬', meaning: 'To continue', context: 'ç¹¼é… = second wife.' },
            'å´”': { pinyin: 'cuÄ«', meaning: 'Cui (surname)', context: 'Second wife\'s surname.' },
            'å’¸': { pinyin: 'xiÃ¡n', meaning: '(Name)', context: 'Generation name for sons.' },
            'éˆ': { pinyin: 'jÅ«n', meaning: '(Name)', context: 'Eldest son\'s name.' },
            'å‡º': { pinyin: 'chÅ«', meaning: 'From', context: 'é™³å‡º = born of Chen.' },
            'é€': { pinyin: 'shÃ¬', meaning: 'To die', context: 'å…ˆé€ = died first.' },
            'æ¬¡': { pinyin: 'cÃ¬', meaning: 'Second', context: 'Second son.' },
            'é¾¢': { pinyin: 'hÃ©', meaning: 'Harmony', context: 'Third son\'s name.' },
            'å¥³': { pinyin: 'nÇš', meaning: 'Daughter', context: 'Female offspring.' },
            'é©': { pinyin: 'shÃ¬', meaning: 'To marry (women)', context: 'é©X = married to X.' },
            'ä½™': { pinyin: 'yÃº', meaning: 'Yu (surname)', context: 'Son-in-law\'s surname.' },
            'é Œ': { pinyin: 'sÃ²ng', meaning: 'To praise', context: 'Part of name.' },
            'å¨': { pinyin: 'wÄ“i', meaning: 'Prestige', context: 'Part of name.' },
            'é™¸': { pinyin: 'lÃ¹', meaning: 'Lu (surname)', context: 'Son-in-law\'s surname.' },
            'çŸ³': { pinyin: 'shÃ­', meaning: 'Stone', context: 'Part of name.' },
            'å¾…': { pinyin: 'dÃ i', meaning: 'To wait', context: 'å¾…å­— = awaiting marriage.' },
            'éµ ': { pinyin: 'hÃº', meaning: 'Swan', context: 'Grandson\'s name.' },
            'éµ¬': { pinyin: 'pÃ©ng', meaning: 'Roc', context: 'Grandson\'s name.' },
            'é´»': { pinyin: 'hÃ³ng', meaning: 'Swan', context: 'Grandson\'s name.' },
            'é¶´': { pinyin: 'hÃ¨', meaning: 'Crane', context: 'Grandson\'s name.' }
        };

        // Layout data - EXACT POSITIONS FROM ORIGINAL COMMIT ecf7514
        const textLayout = [
            { type: 'title', section: 'title', chars: 'é®‘å…¬æ†é½‹ç”Ÿå£™å¿—', x: -20, y: 7, size: 16, spacing: 1.14 },
            { type: 'text', section: 'ancestry', chars: 'å…¬åå“²æ³°å­—æ†é½‹å§“é®‘æ°', x: -79, y: 8, size: 16, spacing: 1.14 },
            { type: 'text', section: 'ancestry', chars: 'ä¸–ç¯¤é„å—é„å¡˜é„‰é®‘å®¶åŸ­äºº', x: -54, y: 200, size: 16, spacing: 1.14 },
            { type: 'text', section: 'family_background', chars: 'æ›¾ç¥–å»·æšç¥–å…‰è¯çˆ¶', x: -27, y: 412, size: 16, spacing: 1.14 },
            { type: 'text', section: 'family_background', chars: 'æ˜æ˜Œæ¯ä¾¯æ°å…„å¼ŸäºŒäººå…¬å…¶é•·ä¹Ÿ', x: -30, y: 8, size: 16, spacing: 1.14 },
            { type: 'text', section: 'youth', chars: 'è‡ªå¹¼å‹¤å¥®æ¨¸å¯¦å¾ªè¦è¹ˆçŸ©å…ˆå–ªæ¯å¾Œå–ªçˆ¶', x: -4, y: 258, size: 16, spacing: 1.14 },
            { type: 'text', section: 'occupation', chars: 'å¹´åä¸‰å³æ£„æ›¸è€Œè³ˆå°±æ¥­æ–¼é„‰ä¹‹äº¬è˜‡é›œè²¨è‚†å…¼å”®é¦–é£¾ç·åŒ¹æ—¢ä¸å¾—å¿—å‰‡', x: -7, y: 9, size: 16, spacing: 1.14 },
            { type: 'text', section: 'occupation', chars: 'é§•é‡£èˆ¹æ•é­šæ±Ÿæµ™æµ·ä¸­å¹´ä¸‰åå§‹å®¢ä¸Šæµ·ç‡Ÿè¡£æ¥­æ—‹ç¶“ç†ç…¤è™Ÿè‡ªæ˜¯çµ‚èº«ä¸€', x: -10, y: 8, size: 16, spacing: 1.14 },
            { type: 'text', section: 'virtues', chars: 'æ¥­å€™æ™‚æ®–è²¨æ­²æœ‰å¥‡è´å•†å ´ç¨±ä¿¡ç¾©ç„‰å¥‰è€¶ç©Œæ•™æ„›äººå¦‚å·±æ¨‚å–„å¥½æ–½è€è€Œ', x: -14, y: 7, size: 16, spacing: 1.14 },
            { type: 'text', section: 'virtues', chars: 'ä¸å€¦åœ¨æ»¬å¦‚å¯§æ³¢åŒé„‰æœƒå››æ˜å…¬æ‰€å››æ˜é†«é™¢é’å¹´æœƒç­‰çš†ç«­èª è³‡åŠ©åœ¨é„‰', x: -18, y: 10, size: 16, spacing: 1.14 },
            { type: 'text', section: 'virtues', chars: 'èˆˆè¾¦å­¸æ ¡ä¿®è‘ºå®—ç¥ é›–æ•¸åƒé‡‘ä¸å°‘åè“‹å¤é„‰é‡Œä¹‹å–„äººä»Šå®—æ•™ä¹‹ä¿¡å¾’ä¹Ÿ', x: -22, y: 8, size: 16, spacing: 1.14 },
            { type: 'text', section: 'family', chars: 'ç„¡æ„§ç„‰å…ƒé…é™³æ°å‰å’ç¹¼é…å´”æ°å­ä¸‰é•·å’¸éˆé™³å‡ºå…ˆé€æ¬¡å’¸é˜ä¸‰å’¸é¾¢çš†', x: -26, y: 9, size: 16, spacing: 1.14 },
            { type: 'text', section: 'family', chars: 'å´”å‡ºå¥³å››äººé©ä½™é Œå¨é™¸é³³çŸ³ä¸‰å››å¾…å­—å­«å››äººæ­£éµ æ­£éµ¬æ­£é´»æ­£é¶´å…¬ç”Ÿ', x: -29, y: 9, size: 16, spacing: 1.14 },
            { type: 'text', section: 'death', chars: 'æ–¼å‰æ¸…åŒæ²»å››å¹´ä¹™ä¸‘ä¹æœˆäºŒåä¸ƒæ—¥æ­²ç”²å­å¹´æ­£å…­å æœˆç‡Ÿç”Ÿå£™æ–¼å¤©', x: -34, y: 10, size: 16, spacing: 1.14 },
            { type: 'credit', section: 'credit', chars: 'åŒé‚‘å¼µç¾ç¿Šæ’°æ–‡', x: 324, y: 357, size: 16, spacing: 1.14 },
            { type: 'credit', section: 'credit', chars: 'æ›¸ä¸¹', x: 321, y: 451, size: 16, spacing: 1.14 },
            { type: 'spine', section: 'spine', chars: 'å¥ä¿é®‘æ°å®—è­œ', x: 14, y: 5, size: 28, spacing: 0.80 },
            { type: 'spine', section: 'spine', chars: 'å·å…­', x: 51, y: 167, size: 28, spacing: 0.80 },
            { type: 'spine', section: 'spine', chars: 'ç”Ÿå£™å¿—', x: 95, y: 245, size: 13, spacing: 1.18 },
            { type: 'spine', section: 'spine', chars: 'æ­£å§‹å ‚', x: 112, y: 499, size: 27, spacing: 0.85 },
            { type: 'text', section: 'burial', chars: 'é³³å±±éº“å¢“å‘å', x: 104, y: 8, size: 16, spacing: 1.14 },
            { type: 'text', section: 'burial', chars: 'å‘', x: 130, y: 142, size: 16, spacing: 1.14 },
            { type: 'text', section: 'burial', chars: 'å…¼', x: 158, y: 180, size: 16, spacing: 1.14 },
            { type: 'text', section: 'burial', chars: 'å±±ç’°æ°´æŠ±ç•¶è”­å…¶å—£äºº', x: 182, y: 237, size: 16, spacing: 1.14 },
            { type: 'text', section: 'burial', chars: 'å¤©é³³ä¹‹å±±å½¢å‹¢é£›ç¿”è¯é‡‡ç¿¼ç¿¼å’Œé³´é˜é˜åœå‰æ–¼æ­¤å­å­«ç¹æ˜Œç™¾æ­²ä¹‹å¾Œå…¶', x: 179, y: 9, size: 16, spacing: 1.14 },
            { type: 'text', section: 'burial', chars: 'æ­¸å…¶è—', x: 176, y: 10, size: 16, spacing: 1.14 }
        ];

        // ========== STATE ==========
        let isLocked = false;
        let currentCharEl = null;

        // ========== RENDERING ==========

        function renderDocument() {
            const container = document.getElementById('document');
            container.innerHTML = '';

            textLayout.forEach((column, colIndex) => {
                const colDiv = document.createElement('div');
                colDiv.className = 'column' + (column.type === 'title' ? ' title-column' : '');
                colDiv.dataset.colIndex = colIndex;
                colDiv.dataset.section = column.section;

                if (column.x !== 0 || column.y !== 0) {
                    colDiv.style.transform = `translate(${column.x}px, ${column.y}px)`;
                }

                for (let i = 0; i < column.chars.length; i++) {
                    const char = column.chars[i];
                    const charSpan = document.createElement('span');
                    charSpan.className = 'char';
                    charSpan.textContent = char;
                    charSpan.dataset.char = char;
                    charSpan.dataset.colIndex = colIndex;
                    charSpan.dataset.charIndex = i;
                    charSpan.dataset.section = column.section;

                    if (column.size) {
                        charSpan.style.fontSize = column.size + 'px';
                    }
                    if (column.spacing) {
                        charSpan.style.lineHeight = column.spacing;
                    }

                    charSpan.addEventListener('mouseenter', handleCharHover);
                    charSpan.addEventListener('click', handleCharClick);
                    colDiv.appendChild(charSpan);
                }

                container.appendChild(colDiv);
            });
        }

        // ========== EVENT HANDLERS ==========

        function handleCharHover(event) {
            if (isLocked) return;
            updateDisplay(event.target);
        }

        function handleCharClick(event) {
            event.stopPropagation();
            const charEl = event.target;

            if (isLocked) {
                unlock();
            } else {
                // Lock to this character
                isLocked = true;
                charEl.classList.add('locked');
                currentCharEl = charEl;
                document.getElementById('lockIcon').style.display = 'block';
                updateDisplay(charEl);
            }
        }

        function handleDocumentClick(event) {
            if (event.target.classList.contains('char')) return;
            if (isLocked) {
                unlock();
            }
        }

        function unlock() {
            isLocked = false;
            document.querySelectorAll('.char.locked').forEach(el => el.classList.remove('locked'));
            document.getElementById('lockIcon').style.display = 'none';
            currentCharEl = null;
        }

        function updateDisplay(charEl) {
            const char = charEl.dataset.char;
            const colIndex = parseInt(charEl.dataset.colIndex);
            const charIndex = parseInt(charEl.dataset.charIndex);
            const sectionId = charEl.dataset.section;
            const column = textLayout[colIndex];

            // Clear all highlights
            document.querySelectorAll('.char').forEach(el => {
                el.classList.remove('char-highlight');
            });
            document.querySelectorAll('.phrase-highlight-box').forEach(el => el.remove());
            document.querySelectorAll('.section-highlight-box').forEach(el => el.remove());

            // Highlight current character (RED)
            charEl.classList.add('char-highlight');

            // Find and highlight phrase (BLUE)
            let foundPhrase = null;
            for (const p of phrases) {
                const phraseStart = column.chars.indexOf(p.chars);
                if (phraseStart !== -1 && charIndex >= phraseStart && charIndex < phraseStart + p.chars.length) {
                    foundPhrase = p;
                    // Draw phrase highlight box
                    drawPhraseHighlight(colIndex, phraseStart, p.chars.length);
                    break;
                }
            }

            // If no exact match in this column, find phrase containing this char
            if (!foundPhrase) {
                for (const p of phrases) {
                    if (p.chars.includes(char)) {
                        foundPhrase = p;
                        break;
                    }
                }
            }

            // Highlight section (GREEN) - draw rectangle around column groups
            const section = sections[sectionId];
            drawSectionHighlight(sectionId);

            // Update info panel
            updateInfoPanel(char, foundPhrase, section);
        }

        function drawPhraseHighlight(colIndex, startIdx, length) {
            const colEl = document.querySelector(`[data-col-index="${colIndex}"]`);
            if (!colEl) return;

            const chars = colEl.querySelectorAll('.char');
            if (startIdx >= chars.length) return;

            const firstChar = chars[startIdx];
            const lastChar = chars[Math.min(startIdx + length - 1, chars.length - 1)];

            const colRect = colEl.getBoundingClientRect();
            const firstRect = firstChar.getBoundingClientRect();
            const lastRect = lastChar.getBoundingClientRect();

            // Get current scale factor (use offsetWidth to include border)
            const container = document.getElementById('documentContainer');
            const scale = container.offsetWidth / BASE_SIZE;

            // Phrase box with extra margin outside character highlight
            // Divide by scale since we're positioning inside a scaled container
            const margin = 4;
            const box = document.createElement('div');
            box.className = 'phrase-highlight-box';
            box.style.top = ((firstRect.top - colRect.top) / scale - margin) + 'px';
            box.style.left = ((firstRect.left - colRect.left) / scale - margin) + 'px';
            box.style.width = (Math.max(firstRect.width, lastRect.width) / scale + margin * 2) + 'px';
            box.style.height = ((lastRect.bottom - firstRect.top) / scale + margin * 2) + 'px';

            colEl.appendChild(box);
        }

        function drawSectionHighlight(sectionId) {
            // Find all columns belonging to this section
            const sectionColumns = document.querySelectorAll(`.column[data-section="${sectionId}"]`);
            if (sectionColumns.length === 0) return;

            const documentEl = document.getElementById('document');
            const docRect = documentEl.getBoundingClientRect();

            // Get current scale factor (use offsetWidth to include border)
            const container = document.getElementById('documentContainer');
            const scale = container.offsetWidth / BASE_SIZE;

            // Group contiguous columns (columns that are visually adjacent)
            // First, gather all column rects and sort by x position
            const colData = [];
            sectionColumns.forEach(col => {
                const rect = col.getBoundingClientRect();
                colData.push({ el: col, rect: rect });
            });

            // Sort by x position (right to left for traditional Chinese)
            colData.sort((a, b) => b.rect.left - a.rect.left);

            // Group columns that are close together (within 50px scaled)
            const groups = [];
            let currentGroup = [colData[0]];

            for (let i = 1; i < colData.length; i++) {
                const prev = currentGroup[currentGroup.length - 1];
                const curr = colData[i];
                // Check if this column is close to the previous one
                const gap = prev.rect.left - curr.rect.right;
                if (gap < 50 * scale) {
                    currentGroup.push(curr);
                } else {
                    groups.push(currentGroup);
                    currentGroup = [curr];
                }
            }
            groups.push(currentGroup);

            // Draw a box around each group
            groups.forEach(group => {
                // Calculate bounding box
                let minLeft = Infinity, minTop = Infinity;
                let maxRight = -Infinity, maxBottom = -Infinity;

                group.forEach(({ rect }) => {
                    minLeft = Math.min(minLeft, rect.left);
                    minTop = Math.min(minTop, rect.top);
                    maxRight = Math.max(maxRight, rect.right);
                    maxBottom = Math.max(maxBottom, rect.bottom);
                });

                // Section box with extra margin outside phrase highlight
                // Divide by scale since we're positioning inside a scaled container
                const margin = 8;
                const box = document.createElement('div');
                box.className = 'section-highlight-box';
                box.style.left = ((minLeft - docRect.left) / scale - margin) + 'px';
                box.style.top = ((minTop - docRect.top) / scale - margin) + 'px';
                box.style.width = ((maxRight - minLeft) / scale + margin * 2) + 'px';
                box.style.height = ((maxBottom - minTop) / scale + margin * 2) + 'px';

                documentEl.appendChild(box);
            });
        }

        function updateInfoPanel(char, phrase, section) {
            // Character info (RED box at top)
            const charData = characterData[char];
            document.getElementById('charDisplay').textContent = char;

            if (charData) {
                document.getElementById('pinyin').textContent = charData.pinyin;
                document.getElementById('charMeaning').textContent = charData.meaning;
                document.getElementById('charContext').textContent = charData.context;
            } else {
                document.getElementById('pinyin').textContent = 'â€”';
                document.getElementById('charMeaning').textContent = 'Character not yet documented.';
                document.getElementById('charContext').textContent = '';
            }

            // Phrase info (BLUE box in middle)
            if (phrase) {
                document.getElementById('phraseChinese').textContent = phrase.chars;
                document.getElementById('phraseTranslation').textContent = '"' + phrase.translation + '"';
                document.getElementById('phraseNotes').textContent = phrase.notes;
            } else {
                document.getElementById('phraseChinese').textContent = char;
                document.getElementById('phraseTranslation').textContent = '(Single character)';
                document.getElementById('phraseNotes').textContent = 'Part of a phrase not yet documented.';
            }

            // Section info (GREEN box at bottom)
            if (section) {
                document.getElementById('sectionTitle').textContent = section.name;
                document.getElementById('sectionChinese').textContent = section.chinese;
                document.getElementById('sectionDesc').textContent = section.description;
            }
        }

        // ========== OPACITY SLIDER ==========

        function updateOpacity(value) {
            const v = value / 100;
            document.getElementById('originalImage').style.opacity = 1 - v;
            document.documentElement.style.setProperty('--text-opacity', v);
            document.documentElement.style.setProperty('--text-bg-opacity', v);
        }

        // ========== SCALING ==========

        const BASE_SIZE = 600; // Base container size that positions were calibrated for

        function updateScale() {
            const container = document.getElementById('documentContainer');
            const doc = document.getElementById('document');
            // Use offsetWidth to include border in calculation
            const actualSize = container.offsetWidth;
            const scale = actualSize / BASE_SIZE;
            doc.style.transform = `scale(${scale})`;
        }

        // ========== INITIALIZATION ==========

        document.addEventListener('DOMContentLoaded', () => {
            renderDocument();
            updateScale();

            const slider = document.getElementById('overlaySlider');
            slider.addEventListener('input', (e) => updateOpacity(e.target.value));
            updateOpacity(slider.value);

            document.getElementById('documentContainer').addEventListener('click', handleDocumentClick);

            // Lock icon click handler
            document.getElementById('lockIcon').addEventListener('click', (e) => {
                e.stopPropagation();
                unlock();
            });

            // Initialize with first character
            const firstChar = document.querySelector('.char');
            if (firstChar) {
                updateDisplay(firstChar);
            }

            // Update scale on window resize
            window.addEventListener('resize', updateScale);
        });
    </script>
</body>
</html>
